[Unit]
Description=Carbonio Mailbox Admin proxy sidecar
Documentation=https://docs.zextras.com/
Requires=network-online.target
After=network-online.target carbonio-appserver.service
BindsTo=carbonio-appserver.service
PartOf=carbonio-appserver.target

[Service]
Slice=carbonio-appserver.slice
User=carbonio-mailbox
ExecStart=/usr/bin/consul connect envoy \
    -token-file /etc/carbonio/mailbox-admin/service-discover/token \
    -admin-bind localhost:0 \
    -sidecar-for carbonio-mailbox-admin
Restart=on-failure
RestartSec=15s
ExecReload=/usr/bin/kill -HUP $MAINPID
KillSignal=SIGINT
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
